<ng-template #actionResolutionsHover let-action="hoverAction">
	<div class="resolutions">
		<h4><span jhiTranslate="{{'highCouncilApp.Action.' + hoverAction}}"></span> <span jhiTranslate="highCouncilApp.game.resolutions"></span></h4>
		<table class="table-striped">
			<thead>
				<tr>
					<th jhiTranslate="highCouncilApp.orderResolution.range" style="padding-right: 3px"></th>
					<th jhiTranslate="highCouncilApp.actionResolution.codeNormal"></th>
					<th jhiTranslate="highCouncilApp.actionResolution.codeChancellor"></th>
					<th jhiTranslate="highCouncilApp.actionResolution.codeKingdom"></th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let actionRes of actionResolutions | actionresolutionbyactionfilter:hoverAction">
					<td>{{actionRes.orderResolution.minimum}}-{{actionRes.orderResolution.maximum}}</td>
					<td><jhi-parsed-text-display [text]="actionRes.codeNormal"></jhi-parsed-text-display></td>
					<td><jhi-parsed-text-display [text]="actionRes.codeChancellor"></jhi-parsed-text-display></td>
					<td class="last"><jhi-parsed-text-display [text]="actionRes.codeKingdom"></jhi-parsed-text-display></td>
				</tr>
			</tbody>
		</table>
	</div>
</ng-template>

<div *ngIf="game" class="row">
	<div class="col-md-4" *ngIf="game.players">
	    <h1><span jhiTranslate="highCouncilApp.game.players"></span></h1>
		<hr>
	    <div *ngFor="let player of game.players; trackBy: id; last as isLast">
		    <jhi-stat-display [stats]="player" [name]="player.userLogin" [score]="player.score" [isChancellor]="player.chancellor"></jhi-stat-display>
		    <hr *ngIf="!isLast">
	    </div>
	</div>
	<div class="col-md-8">
	    <h2><span jhiTranslate="{{'highCouncilApp.Phase.' + game.phase}}"></span>, <span jhiTranslate="highCouncilApp.game.turn"></span> {{game.turn}}</h2>
	    <jhi-alert-error></jhi-alert-error>
	    <jhi-stat-display [stats]="game.kingdom" [name]="'Kingdom'"></jhi-stat-display>
		<hr>
		<div class="row">
			<div class="col-md-2">From</div>
			<div class="col-md-2">To</div>
			<div class="col-md-8">Message</div>
		</div>
		<div class="messageContainer" #messageContainer>
			<div class="row" *ngFor="let message of messages" style="margin-right: 0px">
				<div class="col-md-2">{{message.fromUser}}</div>
				<div class="col-md-2"><span *ngFor="let toUser of message.toUsers; let isLast = last">{{toUser}}<span *ngIf="!isLast">, </span></span></div>
				<div class="col-md-8">{{message.message}}</div>
			</div>
		</div>
		<div class="row">
	    	<span jhiTranslate="highCouncilApp.game.playerFilter"></span>
	    	<span *ngFor="let player of game.players; trackBy: id" >
		    	<button class="btn d-inline" type="button" aria-pressed="true"
		    		*ngIf="currentUser !== player.userLogin"
		    		[ngClass]="{'btn-primary active': discussionDestinations[player.userLogin]}"
		    		(click)="sendToggle(player.userLogin)"
		    	>
		    		{{player.userLogin}}
		    	</button>
	    	</span>
		</div>
		<div class="row">
			<input type="text" class="d-inline" style="width:89%" #newMessage></input>
			<button [disabled]="!recipientSelected" class="d-inline" style="width:10%" (click)="sendMessage(newMessage.value); newMessage.value=''"><span>Send</span></button>
		</div>
		<br/>
		<div *ngIf="player.ordersExpected > 0">
		    <jhi-stat-display [stats]="ordersSubmitted" [name]="'Orders Submitted'"></jhi-stat-display>
		    <div>
	            <label class="form-control-label" jhiTranslate="highCouncilApp.orders.action" for="field_action" [ngClass]="{'invalid': ordersSubmitted.action === undefined}">Action</label>
		    </div>
		    <div style="height: 30px" class="row justify-content-center" *ngIf="game.phase === 'Orders'">
		        <button class="col-2 piety value first d-none d-lg-inline" jhiTranslate="highCouncilApp.Action.short.Piety" 
		        	[ngClass]="{'selected': ordersSubmitted.action === 'Piety'}" (click)="actionChange('Piety')"
		        	(mouseenter)="setHover('Piety')"
		        	[ngbPopover]="actionResolutionsHover" triggers="mouseenter:mouseleave"
		        >
		        </button>
		        <button class="col-2 popularity value first d-none d-lg-inline" jhiTranslate="highCouncilApp.Action.short.Popularity" 
		        	[ngClass]="{'selected': ordersSubmitted.action === 'Popularity'}" (click)="actionChange('Popularity')"
		        	(mouseenter)="setHover('Popularity')"
		        	[ngbPopover]="actionResolutionsHover" triggers="mouseenter:mouseleave"
		        >
		        </button>
		        <button class="col-2 military value first d-none d-lg-inline" jhiTranslate="highCouncilApp.Action.short.Military" 
		        	[ngClass]="{'selected': ordersSubmitted.action === 'Military'}" (click)="actionChange('Military')"
		        	(mouseenter)="setHover('Military')"
		        	[ngbPopover]="actionResolutionsHover" triggers="mouseenter:mouseleave"
		        >
		        </button>
		        <button class="col-2 wealth value first d-none d-lg-inline" jhiTranslate="highCouncilApp.Action.short.Wealth" 
		        	[ngClass]="{'selected': ordersSubmitted.action === 'Wealth'}" (click)="actionChange('Wealth')"
		        	(mouseenter)="setHover('Wealth')"
		        	[ngbPopover]="actionResolutionsHover" triggers="mouseenter:mouseleave"
		        >
		        </button>
		        <button class="col-2 favour value first d-none d-lg-inline" jhiTranslate="highCouncilApp.player.favourShort" 
		        	[ngClass]="{'selected': ordersSubmitted.action === 'Favour'}" (click)="actionChange('Favour')"
		        	(mouseenter)="setHover('Favour')"
		        	[ngbPopover]="actionResolutionsHover" triggers="mouseenter:mouseleave"
		        >
		        </button>
		    </div>
	    	<button class="btn d-inline" type="button" aria-pressed="false"
	    		(click)="toggleLock()"
		    	[ngClass]="{'btn-primary active': ordersLocked}"
		    	[disabled]="!ordersSubmitted.action 
		    		|| (ordersSubmitted.wealth + ordersSubmitted.piety + ordersSubmitted.popularity + ordersSubmitted.military + ordersSubmitted.favour != player.ordersExpected)
		    		|| game.phase != 'Orders'"
	    		jhiTranslate="highCouncilApp.game.lockOrders"
	    	></button>
		    <jhi-order-submit [name]="'Orders'" [numberToSubmit]="player.ordersExpected" (submitted)="receiveOrders($event)"></jhi-stat-display>
		</div>
	</div>
	<div style="padding-top: 10px">
	    <button type="submit"
	            (click)="previousState()"
	            class="btn btn-info">
	        <span class="fa fa-arrow-left"></span>&nbsp;<span jhiTranslate="entity.action.back"> Back</span>
	    </button>
		
	    <button type="button"
	            [routerLink]="['/', { outlets: { popup: 'game/'+ game.id + '/edit'} }]"
	            replaceUrl="true"
	            class="btn btn-primary">
	        <span class="fa fa-pencil"></span>&nbsp;<span jhiTranslate="entity.action.edit"> Edit</span>
	    </button>
	</div>
</div>
